import { useState } from 'react';
import { PageComponentProps } from '../types/navigation.types';
import { Copy, Check, ArrowLeft, ChevronLeft, ChevronRight } from 'lucide-react';
import { Footer } from './Footer';
import java8SnippetsData from '../data/java8-snippets.json';
import java17SnippetsData from '../data/java17-snippets.json';

interface CodeSnippet {
    title: string;
    description: string;
    code: string;
    category: string;
}

type ViewMode = 'landing' | 'java8' | 'java17';

const java8Snippets: CodeSnippet[] = java8SnippetsData as CodeSnippet[];
const java17Snippets: CodeSnippet[] = java17SnippetsData as CodeSnippet[];
{
    title: "Lambda Expressions",
        description: "Concise way to represent anonymous functions",
            code: `// Traditional way
Runnable r1 = new Runnable() {
    public void run() {
        System.out.println("Hello");
    }
};

// Lambda expression
Runnable r2 = () -> System.out.println("Hello");

// With parameters
List<String> names = Arrays.asList("Alice", "Bob");
names.forEach(name -> System.out.println(name));`,
                category: "java8"
},
{
    title: "Stream API",
        description: "Functional-style operations on collections",
            code: `List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5);

// Filter and map
List<Integer> doubled = numbers.stream()
    .filter(n -> n % 2 == 0)
    .map(n -> n * 2)
    .collect(Collectors.toList());

// Sum using reduce
int sum = numbers.stream()
    .reduce(0, Integer::sum);`,
                category: "java8"
},
{
    title: "Optional Class",
        description: "Container to avoid null pointer exceptions",
            code: `// Creating Optional
Optional<String> optional = Optional.of("Hello");
Optional<String> empty = Optional.empty();

// Using Optional
optional.ifPresent(System.out::println);

String result = optional.orElse("Default");
String result2 = optional.orElseGet(() -> "Computed Default");

// Map and flatMap
Optional<Integer> length = optional.map(String::length);`,
                category: "java8"
},
{
    title: "Method References",
        description: "Shorthand notation for lambda expressions",
            code: `List<String> names = Arrays.asList("Alice", "Bob", "Charlie");

// Static method reference
names.forEach(System.out::println);

// Instance method reference
names.stream()
    .map(String::toUpperCase)
    .forEach(System.out::println);

// Constructor reference
Supplier<List<String>> listSupplier = ArrayList::new;`,
                category: "java8"
},
{
    title: "Default Methods",
        description: "Methods with default implementation in interfaces",
            code: `interface Vehicle {
    default void start() {
        System.out.println("Vehicle starting");
    }
    
    void stop();
}

class Car implements Vehicle {
    @Override
    public void stop() {
        System.out.println("Car stopping");
    }
}`,
                category: "java8"
},
{
    title: "Functional Interfaces",
        description: "Interfaces with single abstract method",
            code: `@FunctionalInterface
interface Calculator {
    int calculate(int a, int b);
}

// Usage
Calculator add = (a, b) -> a + b;
Calculator multiply = (a, b) -> a * b;

int result = add.calculate(5, 3); // 8
int result2 = multiply.calculate(5, 3); // 15`,
                category: "java8"
},
{
    title: "Stream Collectors",
        description: "Collecting stream results into collections",
            code: `List<String> names = Arrays.asList("Alice", "Bob", "Charlie");

// To List
List<String> upperNames = names.stream()
    .map(String::toUpperCase)
    .collect(Collectors.toList());

// To Set
Set<String> nameSet = names.stream()
    .collect(Collectors.toSet());

// Joining strings
String joined = names.stream()
    .collect(Collectors.joining(", "));`,
                category: "java8"
},
{
    title: "Date-Time API",
        description: "Modern date and time handling",
            code: `// Current date and time
LocalDate today = LocalDate.now();
LocalTime now = LocalTime.now();
LocalDateTime dateTime = LocalDateTime.now();

// Creating specific date
LocalDate birthday = LocalDate.of(1990, Month.JANUARY, 15);

// Date operations
LocalDate nextWeek = today.plusWeeks(1);
LocalDate lastMonth = today.minusMonths(1);

// Formatting
DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd");
String formattedDate = today.format(formatter);`,
                category: "java8"
},
{
    title: "Stream Grouping",
        description: "Grouping elements using collectors",
            code: `class Person {
    String name;
    int age;
    Person(String name, int age) {
        this.name = name;
        this.age = age;
    }
}

List<Person> people = Arrays.asList(
    new Person("Alice", 25),
    new Person("Bob", 30),
    new Person("Charlie", 25)
);

// Group by age
Map<Integer, List<Person>> byAge = people.stream()
    .collect(Collectors.groupingBy(p -> p.age));`,
                category: "java8"
},
{
    title: "Parallel Streams",
        description: "Process streams in parallel for better performance",
            code: `List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8);

// Sequential stream
int sum1 = numbers.stream()
    .mapToInt(Integer::intValue)
    .sum();

// Parallel stream
int sum2 = numbers.parallelStream()
    .mapToInt(Integer::intValue)
    .sum();

// Parallel processing
numbers.parallelStream()
    .forEach(System.out::println);`,
                category: "java8"
},
{
    title: "Stream FlatMap",
        description: "Flatten nested structures into single stream",
            code: `List<List<String>> nestedList = Arrays.asList(
    Arrays.asList("a", "b"),
    Arrays.asList("c", "d"),
    Arrays.asList("e", "f")
);

// Flatten nested lists
List<String> flatList = nestedList.stream()
    .flatMap(List::stream)
    .collect(Collectors.toList());

// Result: [a, b, c, d, e, f]`,
                category: "java8"
},
{
    title: "Predicate Interface",
        description: "Functional interface for boolean-valued functions",
            code: `Predicate<Integer> isEven = n -> n % 2 == 0;
Predicate<Integer> isPositive = n -> n > 0;

// Test predicate
boolean result = isEven.test(4); // true

// Combine predicates
Predicate<Integer> isEvenAndPositive = 
    isEven.and(isPositive);

List<Integer> numbers = Arrays.asList(-2, -1, 0, 1, 2, 3, 4);
List<Integer> filtered = numbers.stream()
    .filter(isEvenAndPositive)
    .collect(Collectors.toList());`,
                category: "java8"
}
];

const java17Snippets: CodeSnippet[] = [
    {
        title: "Records",
        description: "Immutable data carrier classes with concise syntax",
        code: `// Old way
public class Person {
    private final String name;
    private final int age;
    
    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }
    // getters, equals, hashCode, toString...
}

// Records (Java 14+, standard in 17)
public record Person(String name, int age) {}

Person person = new Person("Alice", 25);
String name = person.name(); // accessor method`,
        category: "java17"
    },
    {
        title: "Sealed Classes",
        description: "Control which classes can extend or implement",
        code: `// Define permitted subclasses
public sealed class Shape
    permits Circle, Rectangle, Square {
}

public final class Circle extends Shape {
    private double radius;
}

public final class Rectangle extends Shape {
    private double width, height;
}

public non-sealed class Square extends Shape {
    private double side;
}`,
        category: "java17"
    },
    {
        title: "Pattern Matching for instanceof",
        description: "Simplified type checking and casting",
        code: `// Old way
if (obj instanceof String) {
    String str = (String) obj;
    System.out.println(str.length());
}

// Pattern matching (Java 16+)
if (obj instanceof String str) {
    System.out.println(str.length());
}

// With negation
if (!(obj instanceof String str)) {
    return;
}
System.out.println(str.toUpperCase());`,
        category: "java17"
    },
    {
        title: "Text Blocks",
        description: "Multi-line string literals with proper formatting",
        code: `// Old way
String html = "<html>\\n" +
              "  <body>\\n" +
              "    <p>Hello</p>\\n" +
              "  </body>\\n" +
              "</html>";

// Text blocks (Java 15+)
String html = \"\"\"
    <html>
      <body>
        <p>Hello</p>
      </body>
    </html>
    \"\"\";

String json = \"\"\"
    {
      "name": "Alice",
      "age": 25
    }
    \"\"\";`,
        category: "java17"
    },
    {
        title: "Switch Expressions",
        description: "Enhanced switch with expression capabilities",
        code: `// Old switch statement
String result;
switch (day) {
    case MONDAY:
    case FRIDAY:
        result = "Busy";
        break;
    case SATURDAY:
    case SUNDAY:
        result = "Holiday";
        break;
    default:
        result = "Regular";
}

// Switch expression (Java 14+)
String result = switch (day) {
    case MONDAY, FRIDAY -> "Busy";
    case SATURDAY, SUNDAY -> "Holiday";
    default -> "Regular";
};`,
        category: "java17"
    },
    {
        title: "Pattern Matching for switch",
        description: "Type patterns in switch expressions",
        code: `// Pattern matching in switch (Java 17 preview)
static String format(Object obj) {
    return switch (obj) {
        case Integer i -> String.format("int %d", i);
        case Long l -> String.format("long %d", l);
        case Double d -> String.format("double %f", d);
        case String s -> String.format("String %s", s);
        default -> obj.toString();
    };
}

// With guards
case String s when s.length() > 5 -> "Long string";`,
        category: "java17"
    },
    {
        title: "Stream toList() Method",
        description: "Convenient method to collect stream to list",
        code: `List<String> names = Arrays.asList("Alice", "Bob", "Charlie");

// Before Java 16
List<String> upperNames = names.stream()
    .map(String::toUpperCase)
    .collect(Collectors.toList());

// Java 16+ toList()
List<String> upperNames = names.stream()
    .map(String::toUpperCase)
    .toList(); // Returns immutable list

// Note: toList() returns unmodifiable list`,
        category: "java17"
    },
    {
        title: "NullPointerException Enhancement",
        description: "Helpful NPE messages showing exact null reference",
        code: `class Person {
    String name;
    Address address;
}

class Address {
    String city;
}

Person person = new Person();

// Before: NullPointerException
// Now: Cannot read field "city" because 
//      "person.address" is null
String city = person.address.city;

// Much more helpful for debugging nested objects`,
        category: "java17"
    },
    {
        title: "Compact Number Formatting",
        description: "Format numbers in compact, human-readable form",
        code: `import java.text.NumberFormat;
import java.util.Locale;

NumberFormat fmt = NumberFormat.getCompactNumberInstance(
    Locale.US, NumberFormat.Style.SHORT);

System.out.println(fmt.format(1000));    // 1K
System.out.println(fmt.format(1000000)); // 1M
System.out.println(fmt.format(1500));    // 1.5K

NumberFormat longFmt = NumberFormat.getCompactNumberInstance(
    Locale.US, NumberFormat.Style.LONG);
System.out.println(longFmt.format(1000)); // 1 thousand`,
        category: "java17"
    },
    {
        title: "Record Patterns",
        description: "Destructure records in pattern matching",
        code: `record Point(int x, int y) {}

record Rectangle(Point upperLeft, Point lowerRight) {}

// Pattern matching with records (Preview)
static void printArea(Object obj) {
    if (obj instanceof Rectangle(Point ul, Point lr)) {
        int width = lr.x() - ul.x();
        int height = ul.y() - lr.y();
        System.out.println("Area: " + (width * height));
    }
}

Rectangle rect = new Rectangle(
    new Point(0, 10), new Point(10, 0));`,
        category: "java17"
    },
    {
        title: "Enhanced Pseudo-Random",
        description: "New random number generator interface",
        code: `import java.util.random.RandomGenerator;
import java.util.random.RandomGeneratorFactory;

// Get default random generator
RandomGenerator random = RandomGenerator.getDefault();

// Generate random values
int randomInt = random.nextInt(100);
double randomDouble = random.nextDouble();

// List all available algorithms
RandomGeneratorFactory.all()
    .map(RandomGeneratorFactory::name)
    .forEach(System.out::println);`,
        category: "java17"
    },
    {
        title: "Day Period Support",
        description: "Format times with day periods (AM/PM/noon/midnight)",
        code: `import java.time.*;
import java.time.format.*;

LocalTime morning = LocalTime.of(9, 30);
LocalTime afternoon = LocalTime.of(14, 30);
LocalTime midnight = LocalTime.MIDNIGHT;

DateTimeFormatter formatter = DateTimeFormatter
    .ofPattern("h:mm B");

System.out.println(morning.format(formatter));   // 9:30 in the morning
System.out.println(afternoon.format(formatter)); // 2:30 in the afternoon
System.out.println(midnight.format(formatter));  // 12:00 midnight`,
        category: "java17"
    }
];

const ITEMS_PER_PAGE = 12;

export function CheatsheetPage({ onNavigateHome }: PageComponentProps) {
    const [viewMode, setViewMode] = useState<ViewMode>('landing');
    const [currentPage, setCurrentPage] = useState(1);
    const [copiedId, setCopiedId] = useState<string | null>(null);

    const copyToClipboard = async (code: string, id: string) => {
        try {
            await navigator.clipboard.writeText(code);
            setCopiedId(id);
            setTimeout(() => setCopiedId(null), 2000);
        } catch (err) {
            console.error('Failed to copy:', err);
        }
    };

    const getSnippetsForCurrentView = () => {
        if (viewMode === 'java8') return java8Snippets;
        if (viewMode === 'java17') return java17Snippets;
        return [];
    };

    const snippets = getSnippetsForCurrentView();
    const totalPages = Math.ceil(snippets.length / ITEMS_PER_PAGE);
    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
    const endIndex = startIndex + ITEMS_PER_PAGE;
    const currentSnippets = snippets.slice(startIndex, endIndex);

    const handleViewChange = (view: ViewMode) => {
        setViewMode(view);
        setCurrentPage(1);
    };

    const handlePageChange = (page: number) => {
        setCurrentPage(page);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    const renderSnippetCard = (snippet: CodeSnippet, index: number) => {
        const snippetId = `${snippet.category}-${startIndex + index}`;
        const isCopied = copiedId === snippetId;

        return (
            <div
                key={snippetId}
                className="bg-[#1e1e1e] border border-[#323232] rounded-lg overflow-hidden hover:border-[#6897BB] transition-all duration-300 flex flex-col"
            >
                <div className="p-2 border-b border-[#323232] bg-[#2B2B2B]">
                    <h3 className="text-[#CC7832] font-semibold text-sm mb-0.5">
                        {snippet.title}
                    </h3>
                    <p className="text-[#A9B7C6] text-[10px]">
                        {snippet.description}
                    </p>
                </div>

                <div className="flex-1 relative">
                    <pre className="p-2 overflow-x-auto text-[10px] h-full">
                        <code className="text-[#A9B7C6] font-mono leading-tight">
                            {snippet.code}
                        </code>
                    </pre>

                    <button
                        onClick={() => copyToClipboard(snippet.code, snippetId)}
                        className="absolute top-1 right-1 p-1 bg-[#2B2B2B] border border-[#323232] rounded hover:bg-[#3d3d3d] hover:border-[#6897BB] transition-all duration-200"
                        title="Copy to clipboard"
                    >
                        {isCopied ? (
                            <Check className="w-3 h-3 text-green-500" />
                        ) : (
                            <Copy className="w-3 h-3 text-[#A9B7C6]" />
                        )}
                    </button>
                </div>
            </div>
        );
    };

    const renderPagination = () => {
        if (totalPages <= 1) return null;

        const pageNumbers = [];
        for (let i = 1; i <= totalPages; i++) {
            pageNumbers.push(i);
        }

        return (
            <div className="flex items-center justify-center gap-2 mt-6 pb-6">
                <button
                    onClick={() => handlePageChange(currentPage - 1)}
                    disabled={currentPage === 1}
                    className="p-2 bg-[#1e1e1e] border border-[#323232] rounded hover:bg-[#2B2B2B] hover:border-[#6897BB] disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                    title="Previous page"
                >
                    <ChevronLeft className="w-5 h-5 text-[#A9B7C6]" />
                </button>

                <div className="flex gap-2">
                    {pageNumbers.map((pageNum) => (
                        <button
                            key={pageNum}
                            onClick={() => handlePageChange(pageNum)}
                            className={`px-4 py-2 rounded font-medium transition-all ${currentPage === pageNum
                                ? 'bg-[#6897BB] text-white border border-[#6897BB]'
                                : 'bg-[#1e1e1e] text-[#A9B7C6] border border-[#323232] hover:bg-[#2B2B2B] hover:border-[#6897BB]'
                                }`}
                        >
                            {pageNum}
                        </button>
                    ))}
                </div>

                <button
                    onClick={() => handlePageChange(currentPage + 1)}
                    disabled={currentPage === totalPages}
                    className="p-2 bg-[#1e1e1e] border border-[#323232] rounded hover:bg-[#2B2B2B] hover:border-[#6897BB] disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                    title="Next page"
                >
                    <ChevronRight className="w-5 h-5 text-[#A9B7C6]" />
                </button>
            </div>
        );
    };

    const renderLandingPage = () => (
        <div className="w-full overflow-y-auto">
            <div className="max-w-5xl mx-auto px-4 py-12">
                <div className="text-center mb-12">
                    <h2 className="text-4xl font-bold text-white mb-4">
                        Java Cheatsheet
                    </h2>
                    <p className="text-[#A9B7C6] text-lg">
                        Choose a Java version to explore code snippets and examples
                    </p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    {/* Java 8 Card */}
                    <button
                        onClick={() => handleViewChange('java8')}
                        className="group p-8 bg-[#1e1e1e] border-2 border-[#323232] rounded-xl hover:border-[#6897BB] transition-all duration-300 text-left"
                    >
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-3xl font-bold text-[#6897BB] group-hover:text-[#87CEEB] transition-colors">
                                Java 8
                            </h3>
                            <div className="w-12 h-12 bg-[#6897BB] bg-opacity-20 rounded-lg flex items-center justify-center group-hover:bg-opacity-30 transition-all">
                                <span className="text-2xl font-bold text-[#6897BB]">8</span>
                            </div>
                        </div>
                        <p className="text-[#A9B7C6] mb-4">
                            Explore Lambda expressions, Stream API, Optional, and more functional programming features.
                        </p>
                        <div className="flex items-center text-[#6897BB] group-hover:text-[#87CEEB] font-medium">
                            <span>View {java8Snippets.length} snippets</span>
                            <ChevronRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
                        </div>
                    </button>

                    {/* Java 17 Card */}
                    <button
                        onClick={() => handleViewChange('java17')}
                        className="group p-8 bg-[#1e1e1e] border-2 border-[#323232] rounded-xl hover:border-[#CC7832] transition-all duration-300 text-left"
                    >
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-3xl font-bold text-[#CC7832] group-hover:text-[#FFA759] transition-colors">
                                Java 17
                            </h3>
                            <div className="w-12 h-12 bg-[#CC7832] bg-opacity-20 rounded-lg flex items-center justify-center group-hover:bg-opacity-30 transition-all">
                                <span className="text-2xl font-bold text-[#CC7832]">17</span>
                            </div>
                        </div>
                        <p className="text-[#A9B7C6] mb-4">
                            Discover Records, Sealed Classes, Pattern Matching, Text Blocks, and modern language features.
                        </p>
                        <div className="flex items-center text-[#CC7832] group-hover:text-[#FFA759] font-medium">
                            <span>View {java17Snippets.length} snippets</span>
                            <ChevronRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
                        </div>
                    </button>
                </div>
            </div>
        </div>
    );

    const renderSnippetsPage = () => {
        const isJava8 = viewMode === 'java8';
        const titleColor = isJava8 ? 'text-[#6897BB]' : 'text-[#CC7832]';
        const accentColor = isJava8 ? '#6897BB' : '#CC7832';

        return (
            <div className="flex h-full w-full">
                {/* Sidebar */}
                <div className="w-64 bg-[#1e1e1e] border-r border-[#323232] flex flex-col overflow-y-auto">
                    <div className="p-4 border-b border-[#323232]">
                        <h3 className="text-white font-semibold mb-2">Navigation</h3>
                    </div>
                    <nav className="flex-1 p-2">
                        <button
                            onClick={() => handleViewChange('landing')}
                            className="w-full text-left px-3 py-2 rounded text-[#A9B7C6] hover:bg-[#2B2B2B] hover:text-white transition-all mb-1"
                        >
                            ← Back to Home
                        </button>
                        <div className="border-t border-[#323232] my-2"></div>
                        <button
                            onClick={() => handleViewChange('java8')}
                            className={`w-full text-left px-3 py-2 rounded transition-all mb-1 ${viewMode === 'java8'
                                ? 'bg-[#2B2B2B] text-[#6897BB] font-semibold'
                                : 'text-[#A9B7C6] hover:bg-[#2B2B2B] hover:text-white'
                                }`}
                        >
                            Java 8 Features
                        </button>
                        <button
                            onClick={() => handleViewChange('java17')}
                            className={`w-full text-left px-3 py-2 rounded transition-all ${viewMode === 'java17'
                                ? 'bg-[#2B2B2B] text-[#CC7832] font-semibold'
                                : 'text-[#A9B7C6] hover:bg-[#2B2B2B] hover:text-white'
                                }`}
                        >
                            Java 17 Features
                        </button>
                    </nav>
                </div>

                {/* Main Content */}
                <div className="flex-1 overflow-y-auto">
                    <div className="max-w-7xl mx-auto px-6 py-6">
                        <div className="mb-6">
                            <h2 className={`text-3xl font-bold ${titleColor} mb-2`}>
                                {isJava8 ? 'Java 8 Features' : 'Java 17 Features'}
                            </h2>
                            <div className="h-1 w-20 rounded" style={{ backgroundColor: accentColor }}></div>
                            <p className="text-[#A9B7C6] mt-3">
                                Page {currentPage} of {totalPages} • Showing {currentSnippets.length} of {snippets.length} snippets
                            </p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                            {currentSnippets.map((snippet, index) => renderSnippetCard(snippet, index))}
                        </div>

                        {renderPagination()}
                    </div>
                </div>
            </div>
        );
    };

    return (
        <div className="h-screen bg-[#2B2B2B] text-[#A9B7C6] flex flex-col">
            {/* Header */}
            <div className="sticky top-0 z-10 bg-[#1e1e1e] border-b border-[#323232] backdrop-blur-sm bg-opacity-95">
                <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                    <div className="flex items-center gap-4">
                        <button
                            onClick={onNavigateHome}
                            className="p-2 hover:bg-[#2B2B2B] rounded-lg transition-colors"
                            title="Back to Home"
                        >
                            <ArrowLeft className="w-5 h-5 text-[#6897BB]" />
                        </button>
                        <h1 className="text-2xl font-bold text-white">
                            Java Cheatsheet
                        </h1>
                    </div>
                    {viewMode !== 'landing' && (
                        <div className="text-sm text-[#808080]">
                            All code snippets are copyable
                        </div>
                    )}
                </div>
            </div>

            {/* Content */}
            <div className="flex-1 overflow-hidden flex">
                {viewMode === 'landing' ? renderLandingPage() : renderSnippetsPage()}
            </div>

            <Footer />
        </div>
    );
}
